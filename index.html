<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Product Search (Protected)</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: black; }
        .lock { font-size: 24px; }
        .welcome { font-weight: bold; font-size: 18px; color: green; }
        .product { margin-bottom: 20px; border-bottom: 1px solid gray; padding-bottom: 10px; }
        .brand { font-weight: bold; font-size: 20px; }
        .mf { font-weight: bold; font-size: 18px; color: #333; }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1><span class="lock">ðŸ”’</span> Product Search (Protected)</h1>
    <p class="welcome"><input type="checkbox" checked disabled> Welcome to Ø§Ù„Ø¹Ù‚ÙŠØ¯ Portal</p>

    <input type="text" id="searchBox" placeholder="Ø§Ø¨Ø­Ø«" oninput="searchProducts()">
    <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

    <div id="results"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD4-FZ8MjqFg-lGzTS9FOuHTsLg7Otq-7s",
            authDomain: "bmlist-july.firebaseapp.com",
            projectId: "bmlist-july",
            storageBucket: "bmlist-july.appspot.com",
            messagingSenderId: "699884995490",
            appId: "1:699884995490:web:1562e8b70f05d76b438d5d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let allProducts = [];

        async function loadProducts() {
            const snapshot = await db.collection("product").get();
            allProducts = snapshot.docs.map(doc => doc.data());
            searchProducts(); // Trigger display initially
        }

        function searchProducts() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const filtered = allProducts.filter(p =>
                p.brand?.toLowerCase().includes(query) ||
                p.description?.toLowerCase().includes(query)
            );

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = filtered.map(p => `
                <div class="product">
                    <div class="brand">${p.brand}</div>
                    <div>${p.description}</div>
                    <div><em>${p.category}</em></div>
                    <div class="mf">MF: ${p.points_multiplier ?? 'â€”'}</div>
                </div>
            `).join('');
        }

        function logout() {
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.");
        }

        loadProducts();
    </script>
</body>
</html>
